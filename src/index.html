<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆæç‡æ™ºèƒ½ä¼˜åŒ–ä¸å†³ç­–ç³»ç»Ÿ (äº¤äº’å¼æ–¹æ¡ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Harmony -->
    <!-- Application Structure Plan: The SPA is designed with a top-down narrative structure to guide the client through the proposal logically. It starts with a high-level "Dashboard" to establish the massive financial incentive. It then moves to a detailed, interactive demo of "Phase 1: Visual Optimization", allowing the user to actively engage with the core features. Finally, it presents "Phase 2: AI Agent", simulating the future vision with an interactive chat. This structure transforms a static presentation into an experiential journey, making the value proposition tangible and compelling. -->
    <!-- Visualization & Content Choices: 
        1. Dashboard Stats (Goal: Inform/Persuade) -> Viz: Large HTML counters. Interaction: Animated numbers on load. Justification: Immediately highlights the key financial benefits (ROI) from the report to capture client interest.
        2. Yield Rate Chart (Goal: Compare) -> Viz: Bar Chart (Chart.js). Interaction: Static. Justification: Provides a simple, universally understood visual of the potential for improvement.
        3. Process Flow Diagram (Goal: Organize) -> Viz: HTML/Tailwind divs. Interaction: Hover effects on steps. Justification: Creates a clean, dependency-free visual representation of the production process described in the report.
        4. Slitting Plan (Goal: Inform/Compare) -> Viz: Horizontal Stacked Bar Chart (Chart.js). Interaction: Dynamically updates when user modifies parameters, serving as the core interactive element of the demo. Justification: This is a creative use of a bar chart to simulate a physical slitting process, effectively visualizing material allocation without complex custom canvas drawing, thus keeping the prototype lightweight.
        5. AI Chat Interface (Goal: Demonstrate Interaction) -> Viz: Styled HTML chat log. Interaction: Pre-scripted conversational flows triggered by user input/clicks. Justification: Perfectly simulates the proposed AI agent's capabilities (forward/reverse/what-if) in a controlled, high-fidelity manner, making the futuristic concept easy to grasp.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f8f7f4; }
        .tab-active { border-color: #3b82f6; color: #3b82f6; background-color: #eff6ff; }
        .tab-inactive { border-color: transparent; color: #4b5563; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .ai-chat-bubble-user { background-color: #3b82f6; color: white; align-self: flex-end; }
        .ai-chat-bubble-agent { background-color: #e5e7eb; color: #1f2937; align-self: flex-start; }
        .param-input {
            width: 100%; padding: 0.5rem; border-radius: 0.375rem; border: 1px solid #d1d5db;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .param-input:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4); }
        .chart-container {
            position: relative;
            width: 100%;
            height: 200px; /* Default height for mobile */
            max-height: 250px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 300px;
                max-height: 350px;
            }
        }
        .flow-step {
            display: flex; align-items: center; justify-content: center;
            padding: 0.75rem 1.5rem; border-radius: 0.5rem;
            background-color: white; border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            text-align: center; font-weight: 500;
            transition: all 0.2s ease-in-out;
        }
        .flow-step:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-color: #3b82f6; }
        .flow-arrow {
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: #9ca3af;
            margin: 0 0.5rem;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="min-h-screen bg-[#f8f7f4] p-4 sm:p-6 lg:p-8">
        <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-lg ring-1 ring-gray-200">
            <!-- Header -->
            <header class="p-6 border-b border-gray-200">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">æ™ºé€ èµ‹èƒ½ï¼Œæ¯«å˜å¿…äº‰</h1>
                <p class="mt-1 text-md text-gray-600">æˆæç‡æ™ºèƒ½ä¼˜åŒ–ä¸å†³ç­–ç³»ç»Ÿ (äº¤äº’å¼æ–¹æ¡ˆ)</p>
            </header>

            <!-- Navigation Tabs -->
            <nav class="flex flex-wrap border-b border-gray-200">
                <button data-tab="dashboard" class="px-4 py-3 sm:px-6 font-medium text-sm sm:text-base border-b-2 tab-active">ğŸ“ˆ ä»·å€¼æ€»è§ˆ</button>
                <button data-tab="phase1" class="px-4 py-3 sm:px-6 font-medium text-sm sm:text-base border-b-2 tab-inactive">ğŸ¨ ä¸€ï¼šå¯è§†åŒ–ååŒä¼˜åŒ–</button>
                <button data-tab="phase2" class="px-4 py-3 sm:px-6 font-medium text-sm sm:text-base border-b-2 tab-inactive">ğŸ¤– äºŒï¼šAIæ™ºèƒ½å†³ç­–</button>
            </nav>

            <!-- Main Content -->
            <main class="p-6">
                <!-- Dashboard Section -->
                <section id="dashboard" class="content-section active">
                    <div class="prose max-w-none">
                        <h2 class="text-xl font-semibold text-gray-800">æˆ˜ç•¥ä»·å€¼ä¸åˆ›æ”¶æ•ˆç›Š</h2>
                        <p class="text-gray-600">æœ¬æ–¹æ¡ˆçš„æ ¸å¿ƒç›®æ ‡æ˜¯çªç ´æˆæç‡ç“¶é¢ˆï¼Œæ¿€æ´»æ•°æ®èµ„äº§ï¼Œå®ç°æ˜¾è‘—çš„é™æœ¬å¢æ•ˆã€‚é€šè¿‡å…ˆè¿›çš„ç®—æ³•ä¸AIæŠ€æœ¯ï¼Œæˆ‘ä»¬å°†æ²‰ç¡çš„ç”Ÿäº§æ•°æ®è½¬åŒ–ä¸ºé©±åŠ¨å†³ç­–çš„å¼ºå¤§å¼•æ“ï¼Œä¸ºä¼ä¸šå¸¦æ¥å¯é‡åŒ–çš„ç›´æ¥ç»æµå›æŠ¥ã€‚</p>
                    </div>

                    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 p-6 rounded-xl border border-blue-200 text-center">
                            <p class="text-lg font-medium text-blue-800">æˆæç‡æ¯æå‡ 1%</p>
                            <p class="text-4xl font-bold text-blue-600 mt-2">Â¥ <span id="roi-value">0</span> ä¸‡</p>
                            <p class="text-sm text-blue-700 mt-2">ç›´æ¥å¹´æ”¶å…¥å¢é•¿</p>
                        </div>
                        <div class="bg-green-50 p-6 rounded-xl border border-green-200 text-center">
                            <p class="text-lg font-medium text-green-800">ä½™æ–™ä»·å€¼æœ€å¤§åŒ–</p>
                            <p class="text-4xl font-bold text-green-600 mt-2">~ <span id="scrap-value">15</span>%</p>
                            <p class="text-sm text-green-700 mt-2">éšå½¢æˆæœ¬é™ä½</p>
                        </div>
                        <div class="bg-purple-50 p-6 rounded-xl border border-purple-200 text-center">
                            <p class="text-lg font-medium text-purple-800">è®¢å•å“åº”é€Ÿåº¦</p>
                            <p class="text-4xl font-bold text-purple-600 mt-2">> <span id="speed-value">50</span>%</p>
                            <p class="text-sm text-purple-700 mt-2">äº¤ä»˜èƒ½åŠ›æå‡</p>
                        </div>
                    </div>

                    <div class="mt-8 bg-gray-50 p-6 rounded-xl border border-gray-200">
                        <h3 class="font-semibold text-lg text-gray-800">æˆæç‡æå‡æ½œåŠ›åˆ†æ</h3>
                        <div class="chart-container mt-4 mx-auto max-w-3xl">
                            <canvas id="yieldRateChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Phase 1 Section -->
                <section id="phase1" class="content-section">
                    <div class="prose max-w-none">
                        <h2 class="text-xl font-semibold text-gray-800">ä¸€ï¼šå¯è§†åŒ–ååŒä¼˜åŒ–å¹³å°</h2>
                        <p class="text-gray-600">æœ¬å¹³å°æ—¨åœ¨å°†å¤æ‚çš„å·¥è‰ºå‚æ•°è®¡ç®—è¿‡ç¨‹å˜å¾—â€œçœ‹å¾—è§ã€æ‘¸å¾—ç€ã€å¯äº¤äº’â€ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä¸€ä¸ªåˆåŒï¼ŒåŠ¨æ€ä¿®æ”¹å·¥è‰ºå‚æ•°ï¼Œå®æ—¶è§‚å¯Ÿå…¶å¯¹åˆ†åˆ‡æ–¹æ¡ˆå’Œæˆæç‡çš„å½±å“ï¼Œä½“éªŒå‰æ‰€æœªæœ‰çš„å·¥è‰ºâ€œæ•°å­—æ²™ç›˜â€ã€‚</p>
                    </div>

                    <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Controls Panel -->
                        <div class="lg:col-span-1 bg-gray-50 p-4 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800 mb-4">ä¼˜åŒ–æ§åˆ¶å°</h3>
                            
                            <div>
                                <label for="contract-select" class="block text-sm font-medium text-gray-700">1. é€‰æ‹©æ¼”ç¤ºåˆåŒ</label>
                                <select id="contract-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                    <option value="C20250701-01">C20250701-01 (å•åˆåŒ)</option>
                                    <option value="multi-contract">å¤šåˆåŒæ‹¼å‰ª</option>
                                </select>
                            </div>

                            <div class="mt-4">
                                <p class="block text-sm font-medium text-gray-700">2. åŠ¨æ€è°ƒæ•´å…³é”®å‚æ•°</p>
                                <div class="mt-2 space-y-3">
                                    <div>
                                        <label for="param-cut-edge" class="block text-xs text-gray-600">åˆ‡è¾¹é‡ (mm)</label>
                                        <input type="number" id="param-cut-edge" value="15" class="param-input">
                                    </div>
                                    <div>
                                        <label for="param-cut-head" class="block text-xs text-gray-600">åˆ‡å¤´é‡ (mm)</label>
                                        <input type="number" id="param-cut-head" value="500" class="param-input">
                                    </div>
                                    <div>
                                        <label for="param-cut-tail" class="block text-xs text-gray-600">åˆ‡å°¾é‡ (mm)</label>
                                        <input type="number" id="param-cut-tail" value="500" class="param-input">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                 <button id="recalculate-btn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300">
                                    ğŸ”„ é‡æ–°è®¡ç®—
                                </button>
                            </div>
                        </div>

                        <!-- Visualization Panel -->
                        <div class="lg:col-span-2">
                            <div class="bg-white p-4 rounded-xl ring-1 ring-gray-200">
                                <h3 id="visual-title" class="font-semibold text-lg text-gray-800 mb-2">åˆåŒ C20250701-01 ä¼˜åŒ–æ–¹æ¡ˆ</h3>
                                <p id="visual-subtitle" class="text-sm text-gray-500 mb-4">å®æ—¶æ¨¡æ‹Ÿç”Ÿäº§æµç¨‹ä¸åˆ†åˆ‡ç»“æœ</p>

                                <h4 class="font-medium text-gray-700 mb-3">å·¥è‰ºæµç¨‹</h4>
                                <div class="flex flex-wrap items-center justify-center text-sm text-gray-700">
                                    <div class="flow-step">é“¸é”­</div>
                                    <div class="flow-arrow">â†’</div>
                                    <div class="flow-step">çƒ­è½§</div>
                                    <div class="flow-arrow">â†’</div>
                                    <div class="flow-step">ç²—è½§</div>
                                    <div class="flow-arrow">â†’</div>
                                    <div class="flow-step">ç²¾è½§</div>
                                    <div class="flow-arrow">â†’</div>
                                    <div class="flow-step">åˆ†åˆ‡</div>
                                </div>

                                <h4 class="font-medium text-gray-700 mt-6 mb-3">åˆ†åˆ‡æ–¹æ¡ˆä¸æˆæç‡</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center mb-4">
                                    <div class="bg-gray-100 p-3 rounded-lg">
                                        <p class="text-sm font-medium text-gray-600">é¢„ä¼°æˆæç‡</p>
                                        <p id="yield-rate-display" class="text-2xl font-bold text-green-600">92.5%</p>
                                    </div>
                                    <div class="bg-gray-100 p-3 rounded-lg">
                                        <p class="text-sm font-medium text-gray-600">æ€»ä½™æ–™é‡é‡</p>
                                        <p id="scrap-weight-display" class="text-2xl font-bold text-amber-600">185 Kg</p>
                                    </div>
                                </div>
                                <div class="chart-container w-full h-24 md:h-32">
                                    <canvas id="slittingPlanChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Phase 2 Section -->
                <section id="phase2" class="content-section">
                    <div class="prose max-w-none">
                         <h2 class="text-xl font-semibold text-gray-800">äºŒï¼šAIæ™ºèƒ½å†³ç­–å¼•æ“</h2>
                        <p class="text-gray-600">ä½“éªŒä¸â€œAIå·¥è‰ºå¤§å¸ˆâ€çš„å¯¹è¯ã€‚æ‚¨å¯ä»¥æå‡ºç›®æ ‡ã€æ›´æ”¹æ¡ä»¶ï¼ŒAIå°†ä¸ºæ‚¨è¿›è¡Œå¤æ‚çš„æ­£å‘ã€é€†å‘åŠæ¨¡æ‹Ÿæ¨æ¼”ã€‚è¿™ä¸ä»…æ˜¯å·¥å…·çš„è¿›åŒ–ï¼Œæ›´æ˜¯å†³ç­–æ–¹å¼çš„é©å‘½ã€‚è¯·ä»ä¸‹é¢çš„å»ºè®®é—®é¢˜å¼€å§‹ï¼Œæˆ–è¾“å…¥æ‚¨è‡ªå·±çš„é—®é¢˜ã€‚</p>
                    </div>

                    <div class="mt-6 bg-gray-50 rounded-xl border border-gray-200">
                        <div id="ai-chat-window" class="p-4 h-96 overflow-y-auto flex flex-col space-y-4">
                            <div class="ai-chat-bubble-agent p-3 rounded-lg max-w-lg">
                                <p class="font-medium text-sm">AIå·¥è‰ºå¤§å¸ˆ (å°æ™º)</p>
                                <p class="text-sm mt-1">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„AIå·¥è‰ºå¤§å¸ˆã€‚æ‚¨å¯ä»¥å‘æˆ‘å’¨è¯¢ä»»ä½•å…³äºå·¥è‰ºä¼˜åŒ–çš„é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥ä»å¤„ç†ä¸€ä¸ªæ–°åˆåŒå¼€å§‹ï¼Œæˆ–è€…ä»ä¸€ä¸ªæˆå“ç›®æ ‡åå‘æ¨å¯¼ç”Ÿäº§æ–¹æ¡ˆã€‚æ‚¨æƒ³åšä»€ä¹ˆï¼Ÿ</p>
                            </div>
                        </div>
                        <div class="p-4 border-t border-gray-200">
                            <div class="flex flex-wrap gap-2 mb-2">
                                <button class="ai-suggestion-btn text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full hover:bg-blue-200">æ­£å‘è®¡ç®—ï¼šå¤„ç†åˆåŒ C20250701-01</button>
                                <button class="ai-suggestion-btn text-xs bg-green-100 text-green-800 px-3 py-1 rounded-full hover:bg-green-200">åæ¨æ–¹æ¡ˆï¼šæˆå“1.5mm 6061-T6é“å·</button>
                                <button class="ai-suggestion-btn text-xs bg-amber-100 text-amber-800 px-3 py-1 rounded-full hover:bg-amber-200">æ¨¡æ‹Ÿï¼šå¦‚æœåˆ‡è¾¹é‡æ”¹ä¸º12mmä¼šæ€æ ·ï¼Ÿ</button>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input id="ai-chat-input" type="text" placeholder="è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„é—®é¢˜..." class="flex-grow param-input">
                                <button id="ai-chat-send" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300">å‘é€</button>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Chart & Data Setup ---
            let yieldRateChart, slittingPlanChart;
            const initialYieldData = {
                current: 88.5,
                optimized: 91.2,
                potential: 92.5,
                theoretical: 95.0
            };
            
            const contractData = {
                "C20250701-01": {
                    params: { edge: 15, head: 500, tail: 500 },
                    calculate() {
                        const baseYield = 92.0;
                        const edgeFactor = (15 - this.params.edge) * 0.1;
                        const headFactor = (500 - this.params.head) / 1000 * 0.05;
                        const tailFactor = (500 - this.params.tail) / 1000 * 0.05;
                        const finalYield = baseYield + edgeFactor + headFactor + tailFactor;
                        const scrapWeight = 2500 * (1 - finalYield / 100);
                        return { 
                            yield: finalYield.toFixed(1), 
                            scrap: scrapWeight.toFixed(0),
                            plan: [
                                { label: 'åˆ‡å¤´ä½™æ–™', value: this.params.head, color: '#fca5a5' },
                                { label: 'æˆå“å·1', value: 3000, color: '#60a5fa' },
                                { label: 'æˆå“å·2', value: 3000, color: '#60a5fa' },
                                { label: 'åˆ‡å°¾ä½™æ–™', value: this.params.tail, color: '#fca5a5' },
                                { label: 'åˆ‡è¾¹ä½™æ–™', value: this.params.edge * 10, color: '#fdba74' }
                            ]
                        };
                    }
                },
                "multi-contract": {
                    params: { edge: 18, head: 600, tail: 600 },
                    calculate() {
                         const baseYield = 90.5;
                        const edgeFactor = (18 - this.params.edge) * 0.1;
                        const headFactor = (600 - this.params.head) / 1000 * 0.05;
                        const tailFactor = (600 - this.params.tail) / 1000 * 0.05;
                        const finalYield = baseYield + edgeFactor + headFactor + tailFactor;
                        const scrapWeight = 3000 * (1 - finalYield / 100);
                        return { 
                            yield: finalYield.toFixed(1), 
                            scrap: scrapWeight.toFixed(0),
                            plan: [
                                { label: 'åˆ‡å¤´ä½™æ–™', value: this.params.head, color: '#fca5a5' },
                                { label: 'åˆåŒA-å·1', value: 2500, color: '#60a5fa' },
                                { label: 'åˆåŒB-å·1', value: 1500, color: '#4ade80' },
                                { label: 'åˆåŒA-å·2', value: 2500, color: '#60a5fa' },
                                { label: 'å¯ç”¨ä½™æ–™', value: 400, color: '#a3e635' },
                                { label: 'åˆ‡å°¾ä½™æ–™', value: this.params.tail, color: '#fca5a5' },
                                { label: 'åˆ‡è¾¹ä½™æ–™', value: this.params.edge * 10, color: '#fdba74' },
                            ]
                        };
                    }
                }
            };
            
            // --- Animated Counters ---
            function animateValue(obj, start, end, duration) {
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    obj.innerHTML = Math.floor(progress * (end - start) + start);
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }

            animateValue(document.getElementById('roi-value'), 0, 7500, 1500);
            animateValue(document.getElementById('scrap-value'), 0, 15, 1500);
            animateValue(document.getElementById('speed-value'), 0, 50, 1500);

            // --- Tab Navigation ---
            const tabs = document.querySelectorAll('[data-tab]');
            const contentSections = document.querySelectorAll('.content-section');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.dataset.tab;
                    tabs.forEach(t => {
                        t.classList.remove('tab-active');
                        t.classList.add('tab-inactive');
                    });
                    tab.classList.add('tab-active');
                    tab.classList.remove('tab-inactive');

                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === target) {
                            section.classList.add('active');
                        }
                    });
                    // Initialize charts if they are in the active tab and not yet created
                    if(target === 'dashboard' && !yieldRateChart) createYieldRateChart();
                    if(target === 'phase1' && !slittingPlanChart) {
                        createSlittingPlanChart();
                        updatePhase1Visuals();
                    }
                });
            });

            // --- Chart Creation ---
            function createYieldRateChart() {
                const ctx = document.getElementById('yieldRateChart').getContext('2d');
                yieldRateChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['å½“å‰å¹³å‡', 'ä¼˜åŒ–å', 'æ–¹æ¡ˆæ½œåŠ›', 'ç†è®ºæé™'],
                        datasets: [{
                            label: 'æˆæç‡ (%)',
                            data: [initialYieldData.current, initialYieldData.optimized, initialYieldData.potential, initialYieldData.theoretical],
                            backgroundColor: ['#9ca3af', '#60a5fa', '#34d399', '#a78bfa'],
                            borderRadius: 6,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: true }
                        },
                        scales: {
                            y: { beginAtZero: false, min: 85, title: { display: true, text: 'æˆæç‡ (%)' } },
                            x: {}
                        }
                    }
                });
            }

            function createSlittingPlanChart() {
                const ctx = document.getElementById('slittingPlanChart').getContext('2d');
                slittingPlanChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['æ¯å·'],
                        datasets: []
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { stacked: true, title: { display: true, text: 'é•¿åº¦/é‡é‡åˆ†å¸ƒ' } },
                            y: { stacked: true }
                        },
                        plugins: {
                            legend: { display: true, position: 'bottom' },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        if (context.parsed.x !== null) {
                                            label += context.parsed.x;
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // --- Phase 1 Logic ---
            const contractSelect = document.getElementById('contract-select');
            const recalcBtn = document.getElementById('recalculate-btn');
            
            function updatePhase1Visuals() {
                if (!slittingPlanChart) return;
                
                const selectedContractId = contractSelect.value;
                const currentContract = contractData[selectedContractId];
                
                // Update params from inputs
                currentContract.params.edge = parseFloat(document.getElementById('param-cut-edge').value);
                currentContract.params.head = parseFloat(document.getElementById('param-cut-head').value);
                currentContract.params.tail = parseFloat(document.getElementById('param-cut-tail').value);

                const results = currentContract.calculate();

                // Update displays
                document.getElementById('visual-title').textContent = selectedContractId === 'multi-contract' 
                    ? 'å¤šåˆåŒæ‹¼å‰ªä¼˜åŒ–æ–¹æ¡ˆ' 
                    : `åˆåŒ ${selectedContractId} ä¼˜åŒ–æ–¹æ¡ˆ`;
                document.getElementById('yield-rate-display').textContent = `${results.yield}%`;
                document.getElementById('scrap-weight-display').textContent = `${results.scrap} Kg`;

                // Update chart
                slittingPlanChart.data.datasets = results.plan.map(item => ({
                    label: item.label,
                    data: [item.value],
                    backgroundColor: item.color,
                    borderWidth: 1,
                    borderColor: '#ffffff'
                }));
                slittingPlanChart.update();
            }
            
            contractSelect.addEventListener('change', () => {
                const selectedContract = contractData[contractSelect.value];
                document.getElementById('param-cut-edge').value = selectedContract.params.edge;
                document.getElementById('param-cut-head').value = selectedContract.params.head;
                document.getElementById('param-cut-tail').value = selectedContract.params.tail;
                updatePhase1Visuals();
            });
            recalcBtn.addEventListener('click', updatePhase1Visuals);

            // --- Phase 2: AI Chat Logic ---
            const chatWindow = document.getElementById('ai-chat-window');
            const chatInput = document.getElementById('ai-chat-input');
            const chatSendBtn = document.getElementById('ai-chat-send');
            const suggestionBtns = document.querySelectorAll('.ai-suggestion-btn');

            const aiResponses = {
                "æ­£å‘è®¡ç®—ï¼šå¤„ç†åˆåŒ C20250701-01": `å¥½çš„ï¼Œæ”¶åˆ°åˆåŒ C20250701-01ã€‚æ­£åœ¨è§£æ...<br><br><strong>ã€åˆæ­¥ç»“æœã€‘</strong><br><ul><li><strong>æ¨èäº§çº¿:</strong> 3å·å†·è½§çº¿</li><li><strong>æ ¸å¿ƒå·¥åº:</strong> çƒ­è½§ â†’ ç²—è½§(2é“æ¬¡) â†’ ç²¾è½§ â†’ è¿ç»­é€€ç« â†’ åˆ†åˆ‡</li><li><strong>é¢„è®¡æˆæç‡:</strong> 92.5%</li><li><strong>å…³é”®å‚æ•°æ‘˜è¦:</strong> åˆ‡è¾¹é‡: 15mm, å‡ºå£åšåº¦: 2.0mm</li></ul><br>å›¾å½¢åŒ–æ–¹æ¡ˆå·²å¯åœ¨ä¸€å¹³å°æŸ¥çœ‹ã€‚è¯·é—®æ‚¨éœ€è¦å®Œæ•´çš„å‚æ•°è¯¦æƒ…ï¼Œè¿˜æ˜¯å¯¹æ–¹æ¡ˆè¿›è¡Œè°ƒæ•´ï¼Ÿ`,
                "åæ¨æ–¹æ¡ˆï¼šæˆå“1.5mm 6061-T6é“å·": `æ”¶åˆ°æ‚¨çš„æˆå“éœ€æ±‚ã€‚æ­£åœ¨è¿›è¡Œåå‘å·¥è‰ºè·¯å¾„è§„åˆ’ï¼ŒåŒ¹é…äº§çº¿èƒ½åŠ›å’Œç‰©æ–™åº“å­˜...<br><br><strong>ã€æœ€ä¼˜ç”Ÿäº§æ–¹æ¡ˆå·²ç”Ÿæˆã€‘</strong><br><ul><li><strong>æ¨èäº§çº¿:</strong> 2å·é«˜ç²¾åº¦å†·è½§çº¿ (å½“å‰è´Ÿè½½è¾ƒä½ä¸”æ»¡è¶³ç²¾åº¦è¦æ±‚)</li><li><strong>æ¨èæ ¸å¿ƒå·¥åºè·¯å¾„:</strong><br>1. é“¸é€ : é€‰ç”¨7000mmçš„6061åˆé‡‘é“¸é”­<br>2. çƒ­è½§: å‡ºå£åšåº¦4.5mm<br>3. ç²—è½§ (3é“æ¬¡)<br>4. T6çƒ­å¤„ç†<br>5. ç²¾è½§ (2é“æ¬¡)<br>6. åˆ†åˆ‡</li><li><strong>å…³é”®å‚æ•°æ‘˜è¦:</strong><br>- æ‰€éœ€é“¸é”­é‡é‡: çº¦6.2å¨<br>- åˆå§‹åˆ‡è¾¹é‡: å»ºè®®20mm<br>- æœ€ç»ˆæˆå“ç‡é¢„ä¼°: <strong>80.6%</strong></li></ul><br>è¿™ä¸ªæ–¹æ¡ˆæ˜¯å¦æ»¡è¶³æ‚¨çš„è¦æ±‚ï¼Ÿæˆ‘å¯ä»¥ä¸ºæ‚¨å±•ç¤ºæ¯ä¸ªå·¥åºçš„è¯¦ç»†å‚æ•°ã€‚`,
                "æ¨¡æ‹Ÿï¼šå¦‚æœåˆ‡è¾¹é‡æ”¹ä¸º12mmä¼šæ€æ ·ï¼Ÿ": `å¥½çš„ï¼Œæ”¶åˆ°æ‚¨çš„è¯·æ±‚ï¼šæ¨¡æ‹Ÿåˆ‡è¾¹é‡æ”¹ä¸º12mmã€‚æ­£åœ¨è¿›è¡Œæ­£å‘æ¨æ¼”...<br><br><strong>ã€æ¨¡æ‹Ÿç»“æœã€‘</strong><br><ul><li><strong>æˆæç‡å˜åŒ–:</strong> ä»92.5% <strong>æå‡</strong> è‡³92.8%ã€‚</li><li><strong>åŸå› åˆ†æ:</strong> åˆ‡è¾¹é‡é‡æŸå¤±å‡å°‘ã€‚</li><li><strong>ç»“è®º:</strong> åœ¨è®¾å¤‡ç²¾åº¦å…è®¸çš„æƒ…å†µä¸‹ï¼Œå»ºè®®é‡‡çº³ã€‚</li></ul><br>æ˜¯å¦éœ€è¦æˆ‘ä¸ºæ‚¨å°†æ­¤å˜æ›´åº”ç”¨åˆ°æ–¹æ¡ˆä¸­ï¼Ÿ`,
                "default": "å¾ˆæŠ±æ­‰ï¼Œä½œä¸ºä¸€ä¸ªæ¼”ç¤ºAIï¼Œæˆ‘è¿˜æ— æ³•å®Œå…¨ç†è§£è¿™ä¸ªé—®é¢˜ã€‚è¯·å°è¯•ç‚¹å‡»ä¸Šæ–¹çš„å»ºè®®é—®é¢˜ï¼Œä½“éªŒæ ¸å¿ƒåŠŸèƒ½ã€‚"
            };

            function addChatMessage(message, sender) {
                const bubble = document.createElement('div');
                bubble.classList.add('p-3', 'rounded-lg', 'max-w-lg', 'text-sm');
                if (sender === 'user') {
                    bubble.classList.add('ai-chat-bubble-user');
                    bubble.innerHTML = `<p>${message}</p>`;
                } else {
                    bubble.classList.add('ai-chat-bubble-agent');
                    bubble.innerHTML = `<p class="font-medium">AIå·¥è‰ºå¤§å¸ˆ (å°æ™º)</p><p class="mt-1">${message}</p>`;
                }
                chatWindow.appendChild(bubble);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            function handleUserMessage(message) {
                if (!message.trim()) return;
                addChatMessage(message, 'user');
                chatInput.value = '';

                setTimeout(() => {
                    const responseKey = Object.keys(aiResponses).find(k => message.includes(k.split('ï¼š')[1].trim()));
                    const response = aiResponses[responseKey] || aiResponses.default;
                    addChatMessage(response, 'agent');
                }, 1000);
            }

            chatSendBtn.addEventListener('click', () => handleUserMessage(chatInput.value));
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleUserMessage(chatInput.value);
            });
            suggestionBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const message = btn.textContent;
                    addChatMessage(message, 'user');
                    setTimeout(() => {
                        addChatMessage(aiResponses[message], 'agent');
                    }, 1000);
                });
            });

            // --- Initial Load ---
            createYieldRateChart();

        });
    </script>
</body>
</html>
